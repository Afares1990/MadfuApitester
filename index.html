<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Madfu API Tester</title>
  <style>
    :root{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
    body{margin:0;padding:20px;background:#f4f7fb;color:#0b0b0b}
    .container{max-width:1100px;margin:0 auto}
    header{display:flex;justify-content:space-between;align-items:center;margin-bottom:18px}
    h1{font-size:20px;margin:0}
    .badge{background:#0b66c2;color:#fff;padding:6px 10px;border-radius:6px;font-weight:600}

    .panel{background:#fff;border-radius:8px;padding:18px;box-shadow:0 2px 8px rgba(20,20,40,0.06);margin-bottom:18px}
    .row{display:flex;gap:12px;flex-wrap:wrap}
    label{display:block;font-size:13px;margin-bottom:6px}
    input[type=text],textarea,select{width:100%;padding:10px;border:1px solid #d7dee9;border-radius:6px;font-size:14px}
    textarea{min-height:120px;resize:vertical}
    .col{flex:1;min-width:220px}
    .actions{display:flex;gap:10px;align-items:center;margin-top:8px}
    button{background:#0b66c2;color:#fff;padding:10px 14px;border:none;border-radius:6px;cursor:pointer}
    button.secondary{background:#eef3fb;color:#0b66c2;border:1px solid #cfe0fb}
    .response{white-space:pre-wrap;background:#071326;color:#bfe1ff;padding:12px;border-radius:6px;min-height:120px;overflow:auto}

    /* Credit card block */
    .card-block{border:1px dashed #cfe0fb;padding:12px;border-radius:8px;background:linear-gradient(180deg,#fff 0%,#f7fbff 100%)}
    .card-row{display:flex;gap:8px}
    .small{font-size:13px}

    /* Doc generation preview table */
    .preview-table{width:100%;border-collapse:collapse;margin-top:12px}
    .preview-table th,.preview-table td{padding:8px;border:1px solid #dbeaf8}
    .preview-table thead{background:#e6f0ff}

    footer{margin-top:12px;font-size:12px;color:#6b7280}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Madfu API Tester</h1>
      <div class="badge">Tester UI Restored</div>
    </header>

    <section class="panel">
      <div style="display:flex;gap:12px;align-items:center;flex-wrap:wrap">
        <div style="flex:1;min-width:260px">
          <label for="endpoint">Endpoint (URL)</label>
          <input id="endpoint" type="text" placeholder="https://api.example.com/path" />
        </div>

        <div style="width:140px">
          <label for="method">Method</label>
          <select id="method">
            <option>GET</option>
            <option>POST</option>
            <option>PUT</option>
            <option>PATCH</option>
            <option>DELETE</option>
            <option>OPTIONS</option>
          </select>
        </div>

        <div style="width:180px">
          <label for="contentType">Content-Type</label>
          <select id="contentType">
            <option>application/json</option>
            <option>application/x-www-form-urlencoded</option>
            <option>multipart/form-data</option>
            <option>text/plain</option>
          </select>
        </div>
      </div>

      <div style="margin-top:12px">
        <label for="headers">Headers (one per line, Key: Value)</label>
        <textarea id="headers" placeholder="Authorization: Bearer &lt;token&gt;\nX-Custom: value"></textarea>
      </div>

      <div style="margin-top:12px">
        <label for="body">Body</label>
        <textarea id="body" placeholder='{"name":"value"}'></textarea>
      </div>

      <div class="actions">
        <button id="send">Send Request</button>
        <button id="pretty" class="secondary">Pretty JSON</button>
        <button id="copy" class="secondary">Copy Response</button>

        <div style="margin-left:auto;display:flex;gap:8px;align-items:center">
          <button id="generateDoc" class="secondary">Generate Doc</button>
          <button id="downloadLog" class="secondary">Download Response</button>
        </div>
      </div>

    </section>

    <section class="panel">
      <h3 style="margin:0 0 10px 0">Response</h3>
      <div id="response" class="response">No response yet.</div>
    </section>

    <section class="panel">
      <h3 style="margin:0 0 10px 0">Credit Card Block</h3>
      <div class="card-block">
        <div class="row">
          <div class="col">
            <label class="small">Cardholder Name</label>
            <input id="cc_name" type="text" placeholder="Jane Doe" />
          </div>
          <div style="width:160px">
            <label class="small">Card Number</label>
            <input id="cc_number" type="text" placeholder="4242 4242 4242 4242" />
          </div>
          <div style="width:100px">
            <label class="small">Expiry</label>
            <input id="cc_expiry" type="text" placeholder="MM/YY" />
          </div>
          <div style="width:80px">
            <label class="small">CVC</label>
            <input id="cc_cvc" type="text" placeholder="123" />
          </div>
        </div>
      </div>

      <div style="margin-top:12px">
        <label class="small">Preview (for documentation)</label>
        <table class="preview-table">
          <thead>
            <tr><th>Field</th><th>Value</th></tr>
          </thead>
          <tbody>
            <tr><td>Cardholder</td><td id="p_name">-</td></tr>
            <tr><td>Number</td><td id="p_number">-</td></tr>
            <tr><td>Expiry</td><td id="p_expiry">-</td></tr>
          </tbody>
        </table>
      </div>
    </section>

    <footer>Madfu API Tester â€” Api documentation Guide included in generated doc</footer>
  </div>

  <script>
    const endpointEl = document.getElementById('endpoint');
    const methodEl = document.getElementById('method');
    const headersEl = document.getElementById('headers');
    const bodyEl = document.getElementById('body');
    const responseEl = document.getElementById('response');

    const ccName = document.getElementById('cc_name');
    const ccNumber = document.getElementById('cc_number');
    const ccExpiry = document.getElementById('cc_expiry');
    const ccCvc = document.getElementById('cc_cvc');

    const pName = document.getElementById('p_name');
    const pNumber = document.getElementById('p_number');
    const pExpiry = document.getElementById('p_expiry');

    function parseHeaders(text){
      const lines = text.split(/\r?\n/).map(l=>l.trim()).filter(Boolean);
      const result = {};
      lines.forEach(line=>{
        const idx = line.indexOf(':');
        if(idx>-1){
          const key = line.slice(0,idx).trim();
          const val = line.slice(idx+1).trim();
          result[key]=val;
        }
      });
      return result;
    }

    document.getElementById('send').addEventListener('click', async ()=>{
      const url = endpointEl.value.trim();
      if(!url){responseEl.textContent='Please provide an endpoint URL.';return}
      const method = methodEl.value;
      const headers = parseHeaders(headersEl.value);
      const opts = {method,headers};
      if(method !== 'GET' && method !== 'DELETE'){
        const contentType = document.getElementById('contentType').value;
        if(contentType) headers['Content-Type'] = contentType;
        let body = bodyEl.value;
        if(contentType === 'application/json'){
          try{ body = JSON.stringify(JSON.parse(body)); }catch(e){}
        }
        opts.body = body;
      }

      responseEl.textContent = 'Loading...';
      try{
        const res = await fetch(url, opts);
        const text = await res.text();
        const ct = res.headers.get('content-type') || '';
        if(ct.includes('application/json')){
          try{ const json = JSON.parse(text); responseEl.textContent = JSON.stringify(json,null,2);}catch(e){responseEl.textContent = text}
        } else {
          responseEl.textContent = text;
        }
      }catch(err){
        responseEl.textContent = 'Request error: ' + err.message;
      }
    });

    document.getElementById('pretty').addEventListener('click', ()=>{
      try{
        const current = responseEl.textContent;
        const obj = JSON.parse(current);
        responseEl.textContent = JSON.stringify(obj,null,2);
      }catch(e){
        alert('Response is not valid JSON');
      }
    });

    document.getElementById('copy').addEventListener('click', ()=>{
      const txt = responseEl.textContent;
      navigator.clipboard.writeText(txt).then(()=>alert('Copied response to clipboard')).catch(()=>alert('Copy failed'));
    });

    document.getElementById('downloadLog').addEventListener('click', ()=>{
      const text = responseEl.textContent || '';
      const blob = new Blob([text],{type:'text/plain;charset=utf-8'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'response.txt';
      document.body.appendChild(a); a.click(); a.remove();
      URL.revokeObjectURL(url);
    });

    // update preview on credit card inputs
    [ccName,ccNumber,ccExpiry].forEach(el=>el.addEventListener('input', ()=>{
      pName.textContent = ccName.value || '-';
      pNumber.textContent = ccNumber.value || '-';
      pExpiry.textContent = ccExpiry.value || '-';
    }));

    // Generate a Word-compatible document (HTML inside a Word file) with blue table and credit card block
    document.getElementById('generateDoc').addEventListener('click', ()=>{
      const title = 'Api documentation Guide';
      const url = endpointEl.value || '-';
      const method = methodEl.value || '-';
      const headers = headersEl.value || '';
      const body = bodyEl.value || '';

      const cardholder = ccName.value || '-';
      const number = ccNumber.value || '-';
      const expiry = ccExpiry.value || '-';
      const cvc = ccCvc.value || '-';

      // Build an HTML document that Word will accept
      const docHtml = `<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<title>${escapeHtml(title)}</title>
<style>
  body{font-family:Arial,Helvetica,sans-serif;color:#0b1f3a}
  h1{color:#0b66c2}
  .meta{margin-bottom:12px}
  .blue-table{width:100%;border-collapse:collapse}
  .blue-table th{background:#0b66c2;color:#fff;padding:8px;text-align:left}
  .blue-table td{padding:8px;border:1px solid #cfe0fb}
  .credit-card{border:1px solid #cfe0fb;padding:10px;border-radius:6px;background:#f7fbff;margin-top:12px}
  .label{font-weight:700;color:#11497a}
</style>
</head>
<body>
  <h1>${escapeHtml(title)}</h1>
  <div class="meta"><strong>Endpoint:</strong> ${escapeHtml(url)} &nbsp; <strong>Method:</strong> ${escapeHtml(method)}</div>
  <table class="blue-table">
    <thead>
      <tr><th>Header / Field</th><th>Value</th></tr>
    </thead>
    <tbody>
      <tr><td>Headers</td><td><pre>${escapeHtml(headers)}</pre></td></tr>
      <tr><td>Body</td><td><pre>${escapeHtml(body)}</pre></td></tr>
      <tr><td>Generated At</td><td>${new Date().toISOString()}</td></tr>
    </tbody>
  </table>

  <div class="credit-card">
    <div class="label">Credit Card</div>
    <div>Cardholder: ${escapeHtml(cardholder)}</div>
    <div>Number: ${escapeHtml(number)}</div>
    <div>Expiry: ${escapeHtml(expiry)}</div>
    <div>CVC: ${escapeHtml(cvc)}</div>
  </div>

</body>
</html>`;

      // Create blob as Word-compatible file. Many versions of Word accept HTML files saved with .doc extension.
      const blob = new Blob([docHtml],{type:'application/msword'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'Api_documentation_Guide.doc';
      document.body.appendChild(a); a.click(); a.remove();
      URL.revokeObjectURL(a.href);
    });

    function escapeHtml(s){
      if(!s) return '';
      return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
    }

  </script>
</body>
</html>