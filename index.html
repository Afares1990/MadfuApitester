<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Madfu API Tester (Merchant)</title>
  <style>
    body { font-family: Arial, Helvetica, sans-serif; margin: 20px; }
    label { display:block; margin-top:10px; }
    input[type=text], input[type=password], textarea { width:100%; padding:8px; box-sizing:border-box; }
    textarea { min-height:80px; }
    .row { display:flex; gap:10px; }
    .col { flex:1; }
    .controls { margin-top:12px; }
    #logs { height:200px; white-space:pre-wrap; overflow:auto; background:#f7f7f7; padding:8px; }
    .small { font-size:0.9em; color:#555; }
    .button { padding:8px 12px; margin-right:8px; }
  </style>
</head>
<body>
  <h1>(Merchant) API Tester</h1>

  <section>
    <h2>Credentials & API</h2>
    <label>Authorization (Bearer)</label>
    <input id="authorization" type="text" placeholder="Bearer ...">

    <div class="row">
      <div class="col">
        <label>AppCode</label>
        <input id="appCode" type="text" placeholder="AppCode">
      </div>
      <div class="col">
        <label>APIKey</label>
        <input id="apiKey" type="text" placeholder="APIKey">
      </div>
    </div>

    <div class="row">
      <div class="col">
        <label>AdminUser</label>
        <input id="adminUser" type="text" placeholder="Admin user">
      </div>
      <div class="col">
        <label>AdminPassword</label>
        <input id="adminPassword" type="password" placeholder="Admin password">
      </div>
    </div>

    <div class="row">
      <div class="col">
        <label>CreateOrder Username</label>
        <input id="username" type="text" placeholder="Username for CreateOrder">
      </div>
      <div class="col">
        <label>CreateOrder Password</label>
        <input id="password" type="password" placeholder="Password for CreateOrder">
      </div>
    </div>

  </section>

  <section>
    <h2>Message Body</h2>
    <label>Message Template / Body</label>
    <textarea id="messageBody" placeholder="Enter the message body you want composed into the Word document. You can include placeholders if needed."></textarea>

    <div class="controls">
      <button class="button" id="generateWord">Generate Word</button>
      <button class="button" id="previewBtn">Preview</button>
    </div>

    <label>Preview</label>
    <textarea id="preview" readonly placeholder="Preview of composed message"></textarea>
  </section>

  <section>
    <h2>Proxy & Requests</h2>
    <label>Proxy URL (optional)</label>
    <input id="proxyUrl" type="text" placeholder="https://your-proxy.example.com/proxy">

    <div class="controls">
      <button class="button" id="sendCreateOrder">Send CreateOrder</button>
      <button class="button" id="sendProxy">Send via Proxy</button>
    </div>

    <p class="small">Checkout link: <a id="checkoutLink" href="#" target="_blank">Open Checkout</a></p>
  </section>

  <section>
    <h2>Logs</h2>
    <div id="logs"></div>
  </section>

  <script>
    // Utility to append logs
    function log(...args) {
      const el = document.getElementById('logs');
      const line = args.map(a => (typeof a === 'object' ? JSON.stringify(a, null, 2) : String(a))).join(' ');
      el.textContent = line + '\n' + el.textContent;
    }

    // Compose the message body using inputs from the page
    function composeMessage() {
      const auth = document.getElementById('authorization').value || '';
      const appCode = document.getElementById('appCode').value || '';
      const apiKey = document.getElementById('apiKey').value || '';
      const adminUser = document.getElementById('adminUser').value || '';
      const adminPassword = document.getElementById('adminPassword').value || '';
      const username = document.getElementById('username').value || '';
      const password = document.getElementById('password').value || '';
      const body = document.getElementById('messageBody').value || '';

      // Compose a human readable message. Adjust formatting as needed.
      const lines = [];
      lines.push('Authorization: ' + auth);
      lines.push('AppCode: ' + appCode);
      lines.push('APIKey: ' + apiKey);
      lines.push('AdminUser: ' + adminUser);
      lines.push('AdminPassword: ' + adminPassword);
      lines.push('CreateOrder Username: ' + username);
      lines.push('CreateOrder Password: ' + password);
      lines.push('');
      lines.push('--- Message Body ---');
      lines.push(body);

      return lines.join('\n');
    }

    // Preview button
    document.getElementById('previewBtn').addEventListener('click', () => {
      const previewText = composeMessage();
      document.getElementById('preview').value = previewText;
      log('Preview generated');
    });

    // Generate Word document (.doc) and download
    document.getElementById('generateWord').addEventListener('click', () => {
      const docText = composeMessage();
      // Populate preview as well
      document.getElementById('preview').value = docText;

      // Create a blob and trigger download as .doc
      const blob = new Blob([docText], { type: 'application/msword' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      const filename = 'message_' + (new Date()).toISOString().replace(/[:.]/g,'-') + '.doc';
      a.href = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
      log('Generated Word document:', filename);
    });

    // Example: send CreateOrder request. Adjust endpoint and payload as needed by your API.
    document.getElementById('sendCreateOrder').addEventListener('click', async () => {
      const endpoint = '/createOrder'; // placeholder - change to real endpoint if needed
      const auth = document.getElementById('authorization').value;
      const appCode = document.getElementById('appCode').value;
      const apiKey = document.getElementById('apiKey').value;
      const username = document.getElementById('username').value;
      const password = document.getElementById('password').value;

      const payload = {
        username,
        password,
        metadata: { appCode, apiKey }
      };

      log('Sending CreateOrder to', endpoint, 'payload:', payload);

      try {
        const res = await fetch(endpoint, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': auth || ''
          },
          body: JSON.stringify(payload)
        });

        const text = await res.text();
        log('CreateOrder response:', res.status, text);
      } catch (err) {
        log('CreateOrder error:', err);
      }
    });

    // Send via proxy: forwards a request to the proxy URL provided
    document.getElementById('sendProxy').addEventListener('click', async () => {
      const proxyUrl = document.getElementById('proxyUrl').value;
      if (!proxyUrl) {
        log('Proxy URL is empty');
        return;
      }

      const targetPath = '/some/api/path'; // placeholder
      const fullUrl = proxyUrl.replace(/\/$/, '') + targetPath;
      const auth = document.getElementById('authorization').value;

      log('Sending proxy request to', fullUrl);

      try {
        const res = await fetch(fullUrl, {
          method: 'GET',
          headers: { 'Authorization': auth || '' }
        });
        const text = await res.text();
        log('Proxy response:', res.status, text);
      } catch (err) {
        log('Proxy error:', err);
      }
    });

    // Set checkout link behavior (keeps existing functionality: an openable link)
    const checkoutLink = document.getElementById('checkoutLink');
    checkoutLink.href = '#';
    checkoutLink.addEventListener('click', (e) => {
      e.preventDefault();
      const checkoutUrl = '/checkout'; // placeholder - adjust to real checkout
      window.open(checkoutUrl, '_blank');
      log('Checkout link opened:', checkoutUrl);
    });

    // Initial log
    log('API Tester loaded. (Merchant)');
  </script>
</body>
</html>
